---
title: RabbitMQ
date: 2022-05-06 19:47:29
tags: Q&A
categories:
- [Q&A, Q&A-java]
---

## rabbitmq 的使用场景有哪些？
* 跨系统的异步通信
* 多应用交互解耦
* 应用内同步变异步
* 消息驱动的架构方式
* 应用需要更灵活的耦合方式
* 跨局域网、城市的通讯（比如cdn）

## rabbitmq 有哪些重要的角色？
|角色|简介|
|---|---|
|生产者|消息创建者，负责创建和推送数据到消息服务器|
|消费者|消息接收方，用于处理数据和确认消息|
|代理|RabbitMQ本身，扮演快递角色，本身不生产消息，传输和管理消息|

## rabbitmq 有哪些重要的组件？
|组建名称|简介|
|---|---|
|ConnectionFactory（连接管理器）|应用于rabbit之间建立的连接的管理器，程序代码中使用|
|Channel（信道）|消息推送使用的通道|
|Exchange（交换器）|用于接收、分配消息|
|Queue（队列）|用于存储生产者消息|
|RoutingKey（路由键）|告诉交换器，需要放到哪个队列中，需要与bindingkey一起使用|
|BindingKey（绑定建）|用于标记交换器与队列的绑定规则，当消息的路由键与绑定建相同时，交换器会将该消息放到绑定建对应的队列中|

## rabbitmq 中 vhost 的作用是什么？
vhost可以理解为broker，即min-RabbitMQ server，其内部含有rabbitmq的所哟组件，特点是拥有独立的权限系统，可以用于权限隔离，即一个RabbitMQ可以让多个应用以权限隔离的方式同时使用

## rabbitmq 的消息是怎么发送的？
连接到RabbitMQ服务器，然后通过认证，然后通过通过信道发送消息，信道是建立在tcp真实连接上的虚拟连接

## rabbitmq 怎么保证消息的稳定性？
* 提供事务功能
* 可将channel设置为confirm模式，RabbitMQ会将消息发送情况返回给生产者

## rabbitmq 怎么避免消息丢失？
1、消息持久化
2、ACK确认机制
3、设置集群镜像模式，数据备份
4、消息补偿机制

## 要保证消息持久化成功的条件有哪些？
#### 需要满足下面四个条件才能实现消息持久化：
1、声明队列的持久化属性durable为true
2、消息推送投递模式设置持久化，deliveryMode设置为2（持久化）
3、消息传输到持久化交换器，前面的流程不包含持久化逻辑
4、消息已到达持久化队列

## rabbitmq 持久化有什么缺点？
持久化特性会降低服务并发性能、数据吞吐量


## rabbitmq 有几种广播类型？
|广播类型|简介|
|---|---|
|fanout|不需要routingkey，只要跟exchange binding的queue都可以接收消息|
|direct|根据routingkey和exchange，只有唯一一个queue可以接收消息|
|topic|所有符合routingkey和bindingkey规则的queue都可以接收消息|

## rabbitmq 怎么实现延迟消息队列？
1、消息过期后进入死信交换器，再由交换器转发到延迟消息队列，实现延迟功能
2、使用RabbitMQ-delayed-message-exchange插件实现延迟功能

## RabbitMQ集群作用或者意义
1、高可用：当某个服务节点出现问题，不影响整体服务可用性
2、高容量：集群可以承载更多消息量

## rabbitmq 集群搭建需要注意哪些问题？
1、各节点之间使用“--link”连接，此属性不可忽略
2、各节点使用的erlang cookie值必须相同，此值相当于“秘钥”功能，用于各节点认证
3、整个集群中必须包含一个磁盘节点

## rabbitmq 每个节点是其他节点的完整拷贝吗？为什么？
#### 不是，原因如下
1、存储空间考虑：每个节点增加了非常多的冗余数据
2、性能考虑：每个节点其实跟单节点本质上是几乎一致的，所以处理性能相比单节点没有优势，甚至更差

## rabbitmq 集群中唯一一个磁盘节点崩溃了会发生什么情况？
#### 集群依然可以运行，但是不能更改任何东西，本质上就是设置到写磁盘的操作都不行了
* 不能创建队列
* 不能创建交换器
* 不能创建绑定
* 不能添加用户
* 不能更改权限
* 不能添加和删除集群节点

## rabbitmq 对集群节点停止顺序有要求吗？
#### 有
先关闭内存节点，最后关闭磁盘节点，目的是避免消息丢失
